"use strict";var WPCL=WPCL||{};WPCL.Library=function(){this.instanceId=null,this.options={iframeHelperURL:"",url:"https://payments.worldpay.com/",type:"lightbox",inject:"default",target:null,trigger:null,lightboxMaskOpacity:50,lightboxMaskColor:"#000000",lightboxShadowColor:"#666",lightboxShadowSize:"30px",accessibility:!1,language:"en",country:"",preferredPaymentMethod:"",disableScrolling:!1,hideContent:!1,checkoutURL:null,successURL:"",cancelURL:"",failureURL:"",pendingURL:"",errorURL:"",expiryURL:"",resultCallback:null,flowCallback:null,customisation:null,debug:!1},this.iframeTitlesLanguageMap={bg:"Страници за плащане",bs:"Stranice za plaćanje",ca:"Pàgines de pagament",cs:"Platební stránky",cy:"Tudalennau talu",da:"Betalingssider",de:"Zahlungsseiten",el:"Σελίδες πληρωμής",en:"Payment Pages",es:"Páginas de pago",et:"Makse leheküljed",fi:"Maksusivut",fr:"Pages de paiement",hi:"भुगतान पेज",hr:"Stranice za plaćanje",hu:"Fizetési oldalak",it:"Pagine di pagamento",ja:"決済ページ",ko:"결제 페이지",lv:"Maksājumu lapas",nb:"Betalingssider",nl:"Betaalpagina’s",no:"Betalingssider",pl:"Strony płatności",pt:"Páginas do pagamento",ro:"Pagini de plată",ru:"Страницы оплаты",si:"ගෙවීම් පිටු",sk:"Webové stránky na vykonávanie platieb",sl:"Plačilne strani",sv:"Betalningssidor",tr:"Ödeme Sayfaları",zh:"支付页面",th:"หน้าชำระเงิน",zh_TW:"支付頁面",es_CO:"Páginas de pago",pt_BR:"Páginas de pagamento"},this.lightboxMaxWidth=750,this.prefix="wp-cl",this.wpName=this.prefix,this.isPostMessage=!1,this.sdkInfoAlreadySent=!1,this.isFakeLoadEvent=!1,this.onloadInject=null,this.postMessageHandler=null},WPCL.Library.prototype=function(){var a=function(){var e=this,t=o(e.options.url);d(e.options.iframeHelperURL)&&E.call(e,"ERROR: iframe helper url is missing"),t=t.replace("/hpp/","/hpp-iframe/"),t=s(t,"iframeIntegrationId",e.instanceId);var a=i.call(e);if(null!=a&&(t=s(t,"checkoutURL",a)),null!=e.options.flowCallback){var n=l.call(e);t=s(t,"iframeOrigin",n)}return t=s(t,"iframeHelperURL",e.options.iframeHelperURL),t=s(t,"language",e.options.language),t=s(t,"country",e.options.country),t=s(t,"preferredPaymentMethod",e.options.preferredPaymentMethod),t=s(t,"disableScrolling",e.options.disableScrolling),t=s(t,"successURL",e.options.successURL),t=s(t,"cancelURL",e.options.cancelURL),t=s(t,"failureURL",e.options.failureURL),t=s(t,"pendingURL",e.options.pendingURL),t=s(t,"errorURL",e.options.errorURL),t=s(t,"expiryURL",e.options.expiryURL),E.call(e,"url set to: "+t),t},i=function(){var e=this.options.checkoutURL;return null!=e?0==(e=e.trim()).length&&(e=null):e=window.location.href,e},l=function(){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")},d=function(e){return!e||0===e.length},o=function(e){return d(e)?e:e.replace(/&amp;/g,"&")},s=function(e,t,a){if(d(a)||d(t))return e;var n=new RegExp("[?&]"+t+"=");if(-1===e.search(n))return e+"&"+t+"="+encodeURIComponent(a);var i=new RegExp("[?&]"+t+"=[^&]");return-1===e.search(i)?e.replace(n,""):e},n=function(e){var t=this;for(var a in e)t.options.hasOwnProperty(a)&&(t.options[a]=e[a]);t.wpName+="-",t.wpName+=t.options.target,E.call(t,"Overriding options with the following:"),E.call(t,JSON.stringify(t.options))},r=function(){E.call(this,"Setting up iframe..."),L.call(this),e.call(this)},e=function(){var t=this,e=document.getElementById(t.options.target);E.call(t,"Injecting iframe into page..."),null!=e?(t.onloadInject=function(){c.call(t)},"immediate"===t.options.inject?c.call(t):"onload"===t.options.inject?window.addEventListener?(E.call(t,"The browser supports addEventListener"),window.addEventListener("load",t.onloadInject,!1)):window.attachEvent?(E.call(t,"The  browser supports attachEvent"),window.attachEvent("onload",t.onloadInject)):E.call(t,"ERROR: the  browser does not support an onload event-handler"):"default"===t.options.inject?window.onload=function(e){c.call(t),e&&e.target&&e.target!=document&&(t.isFakeLoadEvent=!0)}:E.call(t,"ERROR: accepted parameters are immediate, onload, default")):E.call(t,"ERROR: HTML target, specified by 'target' parameter, could not be found - target: "+t.options.target)},c=function(){var e=document.createElement("div");e.id=this.prefix,f.call(this,e),m.call(this,e),y.call(this)},p=function(){var e=this,t=!0;E.call(e,"Setting up lightbox..."),x(e.options.lightboxMaskOpacity)&&(E.call(e,"ERROR: parameter 'lightboxMaskOpacity' is NaN: "+e.options.lightboxMaskOpacity),t=!1),t&&(L.call(e),u.call(e))},u=function(){var e=this,t=document.getElementById(e.options.trigger);E.call(e,"Binding lightbox..."),null!=t?(t.onclick=function(){return g.call(e),!1},E.call(e,"Binded lightbox")):E.call(e,"ERROR: lightbox trigger (element) could not be found - trigger: "+e.options.trigger)},g=function(){var e=this,t=document.getElementById(e.options.target);if(E.call(e,"Injecting lightbox..."),null!=t){var a=document.createElement("div");a.id=e.prefix;var n=document.createElement("div");n.id=e.prefix+"-mask",n.setAttribute("style","position: fixed;top:0;left:0;background: "+e.options.lightboxMaskColor+';width: 100%;height: 100%;-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity='+e.options.lightboxMaskOpacity+')";filter: alpha(opacity='+e.options.lightboxMaskOpacity+");opacity: "+e.options.lightboxMaskOpacity/100+";z-index: 100005;-webkit-transform: translate3d(0,0,0);"),a.appendChild(n);var i=document.createElement("div");i.id=e.prefix+"-content",i.setAttribute("style","position:fixed;top:0;left:0;bottom:0;right:0;width:100%;z-index:100006;padding:16px;box-sizing:border-box;overflow:scroll;-webkit-overflow-scrolling:touch;"),a.appendChild(i);var l=document.createElement("div");l.id=e.prefix+"-lightbox",l.setAttribute("role","dialog"),l.setAttribute("style","top:60px;z-index: 100006;margin: 0 auto;max-width:"+e.lightboxMaxWidth+"px;"),i.appendChild(l);var o=document.createElement("div");o.id=e.wpName,l.appendChild(o),f.call(e,o),m.call(e,a),e.options.accessibility&&v.call(e),S.call(e,0),h.call(e),y.call(e)}else E.call(e,"ERROR: HTML target, specified by 'target' parameter, could not be found - target: "+e.options.target)},h=function(){var e=document.getElementById(this.wpName+"-iframe");null!=e&&document.activeElement!=e&&window.setTimeout(function(){e.focus()},0)},f=function(e){var t=this,a=t.options.customisation,n="iframe"==t.options.type,i="lightbox"==t.options.type,l=null!=a,o=function(){var e=this,t={language:e.options.language,title:e.iframeTitlesLanguageMap[e.options.language]};return(d(t.language)||d(t.title))&&(t.language="en",t.title=e.iframeTitlesLanguageMap.en,E.call(e,"WARN: language '"+e.options.language+"'not found for parameter 'language', using default instead...")),t}.call(t),s=t.options.hideContent,r=document.createElement("iframe");r.id=t.wpName+"-iframe",r.name=t.wpName+"-iframe",r.title=o.title,l||(r.src=t.options.iframeUrl),r.setAttribute("class","wp-cl-iframe"),r.setAttribute("allowtransparency","yes"),r.setAttribute("scrolling","no"),r.setAttribute("frameBorder","0"),r.setAttribute("border","0"),r.setAttribute("allow","payment"),r.setAttribute("allowpaymentrequest","");try{r.allowPaymentRequest=!0}catch(e){E.call(t,"WARN: failed to allow payment request: "+e)}var c=n&&s?0:400;if(r.setAttribute("style","width: 1px;min-width: 100%;*width: 100%;border:0;background: transparent;height:"+c+"px;"+(n&&s?"display: block; visibility:hidden;":"")+(i?"border-radius:6px;overflow:hidden;box-shadow:0 0 "+t.options.lightboxShadowSize+" "+t.options.lightboxShadowColor+";":"")),e.appendChild(r),l){a=JSON.stringify(t.options.customisation);var p=document.createElement("form");p.id=t.wpName+"-iframe-form",p.method="POST",p.action=t.options.iframeUrl,p.target=t.wpName+"-iframe";var u=document.createElement("input");u.type="hidden",u.name="customisation",u.value=a,p.appendChild(u),e.appendChild(p)}return e},m=function(e){var t=document.getElementById(this.options.target);if(null!=t){if(0<t.childNodes.length)for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(e)}else E.call(this,"ERROR: HTML target, specified by 'target' parameter, could not be found - target: "+this.options.target)},y=function(){var e=document.getElementById(this.wpName+"-iframe-form");null!=e&&e.submit()},v=function(){var e=["a","input","select"],t=document.getElementById(this.options.target);E.call(this,"Setting accessibility features");for(var a=0;a<e.length;a++)for(var n=document.getElementsByTagName(e[a]),i=0;i<n.length;i++)n[i].tabIndex=-1;for(var l=0;l<e.length;l++)for(var o=t.getElementsByTagName(e[l]),s=0;s<o.length;s++)o[s].removeAttribute("tabindex")},t=function(){var e=this,t=document.getElementById(e.prefix),a=document.getElementById(e.options.trigger);E.call(e,"Destroying lightbox..."),t&&t.parentNode&&t.parentNode.removeChild(t),e.options.accessibility&&(function(){var e=["a","input","select"];E.call(self,"Removing accessibility changes...");for(var t=0;t<e.length;t++)for(var a=document.getElementsByTagName(e[t]),n=0;n<a.length;n++)a[n].removeAttribute("tabindex")}.call(e),a&&a.focus&&a.focus())},b=function(){null!=this.postMessageHandler&&(window.removeEventListener?window.removeEventListener("message",this.postMessageHandler):window.detachEvent("onmessage",this.postMessageHandler),E.call(self,"INFO: destroyed post message event listener"))},w=function(e,t){var a=this,n=R.call(a);if(null!=n)if(t||!a.isPostMessage){if(a.options.hideContent)E.call(a,"WARN: skipped resizing iframe as hideContent is enabled");else if(n.style.height=parseInt(e)+"px",E.call(a,"iframe resized - height: "+e),"lightbox"===a.options.type){var i=document.body,l=document.documentElement;Math.max(i.scrollHeight,i.offsetHeight,l.clientHeight,l.scrollHeight,l.offsetHeight)<e&&(document.body.style.height=parseInt(e)+"px",E.call(a,"lightbox container resized - height: "+e))}}else E.call(a,"WARN: iframe not found for height resize");else E.call(a,"WARN: iframe not found for height resize")},R=function(){var e=this.wpName+"-iframe",t=document.getElementById(e);return null==t&&E.call(this,"WARN - unable to find iframe - target name: "+e),t},k=function(e){top.location.href=e},x=function(e){return"string"==typeof e||isNaN(e)},E=function(e){this&&this.options&&this.options.debug&&console&&console.log&&console.log("Worldpay HPP JavaScript SDK - "+e)},S=function(e){var t=this.options.type;if(!this.options.disableScrolling&&"iframe"===t){var a=R.call(this).getBoundingClientRect().top,n=window.pageYOffset+a;null!=e&&(n+=e),document.body.scrollTop=n,document.documentElement.scrollTop=n,E.call(this,"changed vertical scroll position: "+n)}},L=function(){var t=this;b.call(t),this.postMessageHandler=function(e){C.call(t,e)},window.addEventListener?window.addEventListener("message",this.postMessageHandler,!1):window.attachEvent("onmessage",this.postMessageHandler)},C=function(e){var t=this;this.isPostMessage=!0;var a=e.origin||e.originalEvent.origin,n=t.options.url;if(null==n||0==n.indexOf(a)||(E.call(t,"WARN - post-message from different source - origin: "+a+", ticketUrl: "+n),t.options.debug)){var i;try{i=JSON.parse(e.data)}catch(e){i=null}if(null!=i&&"hpp"==i.source&&null!=i.action&&null!=i.args)if(null!=i.id&&0<i.id.length&&i.id!=t.instanceId)E.call(t,"ignoring message as different instance - req: "+i.id+", ours: "+t.instanceId);else switch(i.action){case"check":M.call(t);break;case"apple-pay-availability":P.call(t);break;case"do-apple-pay":A.call(t,i);break;case"resize":N.call(t,i);break;case"redirect":T.call(t,i);break;case"scroll":j.call(t,i);break;case"result":B.call(t,i);break;case"flow":H.call(t,i);break;default:E.call(t,"unhandled action: "+i.action)}else E.call(t,"malformed post-message received - "+JSON.stringify(i))}},M=function(){E.call(this,"received postMessage mechanism check, replying back");var e={source:"hpp",action:"check-working",sdkInfo:z.call(this)};D.call(this,e)},P=function(){E.call(this,"received postMessage: apple-pay-availability");var e="false";window.ApplePaySession&&ApplePaySession.canMakePayments&&(e="true");var t={source:"hpp",action:"apple-pay-availability-reply",isApplePayAvailable:e};D.call(this,t)},A=function(e){var n=this;E.call(n,"received postMessage: do-apple-pay");var t=e.args.applePayPaymentRequest,i=e.args.applePayControllerCreateSessionUrlWithHost,a=e.args.applePayControllerAuthorizePaymentUrlWithHost,l=e.args.supportedVersion,o=U.call(n,l),s=new ApplePaySession(o,t);s.onvalidatemerchant=function(e){var t=e.validationURL,a=window.location.hostname;I.call(n,i,{validationUrl:t,initiativeContext:a}).then(function(e){s.completeMerchantValidation(JSON.parse(e))},function(e){s.abort(),O.call(n,"ERROR",e)})},s.onpaymentauthorized=function(e){var t=e.payment.token;I.call(n,a,t).then(function(e){if(e)switch(e){case"SUCCESS":s.completePayment(ApplePaySession.STATUS_SUCCESS),O.call(n,"SUCCESS","");break;case"FAILURE":s.completePayment(ApplePaySession.STATUS_FAILURE),O.call(n,"FAILURE","");break;default:s.completePayment(ApplePaySession.STATUS_FAILURE),O.call(n,"ERROR","")}else s.completePayment(ApplePaySession.STATUS_FAILURE),O.call(n,"ERROR","")},function(e){O.call(n,"ERROR",e)})},s.begin()},U=function(e){var t=e;e:for(;1<t;){if(window.ApplePaySession.supportsVersion(t))break e;t-=1}return t},O=function(e,t){var a={source:"hpp",action:"apple-pay-redirect-reply",status:e,error:t};D.call(this,a)},I=function(i,e){return new Promise(function(t,a){var n=new XMLHttpRequest;n.open("POST",i),n.onload=function(){if(200<=this.status&&this.status<300)t(n.response);else{var e={issueType:"js-apple-pay",message:"Failed for : "+i,statusCode:this.status,statusMessage:n.statusText};a(e)}},n.onerror=function(){var e={issueType:"js-apple-pay",message:"Failed for : "+i,statusCode:this.status,statusMessage:n.statusText};a(e)},n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(e))})},N=function(e){var t=e.args.height;E.call(this,"resizing iframe... - height: "+t),w.call(this,t,!0)},T=function(e){var t=e.args.url;E.call(this,"received redirect message... - url: "+t),k.call(this,t)},j=function(e){var t=e.args.scrollingOffset;E.call(this,"scrolling payments page..."),S.call(this,t)},B=function(e){W.call(this,"result",this.options.resultCallback,e.args.result)},H=function(e){W.call(this,"flow",this.options.flowCallback,e.args)},W=function(e,t,a){null==t?E.call(self,"no "+e+" callback function specified, skipping "+e+" callback invocation"):null==a?E.call(self,"null "+e+" result from payment pages, skipping "+e+" callback invocation"):(E.call(self,"invoking "+e+" callback"),t(a))},z=function(){var e,t=this;if(t.sdkInfoAlreadySent)e={alreadySent:"true"};else{var a=_.call(t),n=t.options.type,i=F.call(t),l=J.call(t),o=q.call(t),s=null!=t.options.resultCallback,r=null!=t.options.flowCallback,c=t.options.inject,p=null!=t.options.customisation;e={version:"29-0",saved:a,integrationType:n,insideFrame:i,parentCrossDomain:l,manualOnload:o,debug:t.options.debug,resultCallback:s,flowCallback:r,inject:c,customisation:p,disableScrolling:t.options.disableScrolling,hideContent:t.options.hideContent},t.sdkInfoAlreadySent=!0}return e},F=function(){try{return top!=window}catch(e){return!0}},J=function(){try{return!(null!=parent&&parent.document)}catch(e){return!0}},q=function(){var e=!1;return"iframe"==this.options.type&&(e=this.isFakeLoadEvent),e},_=function(){for(var e,t=!0,a=document.getElementsByTagName("script"),n=0;t&&n<a.length;n++)null!=(e=a[n].src)&&0<e.indexOf(".worldpay")&&(t=!1);return t},D=function(e){var t=JSON.stringify(e),a=R.call(this);if(null!=a&&a.contentWindow&&a.contentWindow.postMessage){var n=V.call(this);a.contentWindow.postMessage(t,n)}else E.call(this,"unable to send message to payment pages, iframe not available - has it been injected on your page?")},V=function(){var e=this.options.url,t=e.indexOf("/",10);return e.substring(0,t)};return{setup:function(e){var t=this;switch(E.call(t,"Setting up library..."),this.instanceId=(new Date).getTime()+Math.floor(100*Math.random()),n.call(t,e),t.options.iframeUrl=a.call(t),t.options.type){case"iframe":r.call(t);break;case"lightbox":p.call(t);break;default:E.call(t,"ERROR: parameter 'type' is not a valid value")}},destroy:function(){var e=this;"iframe"===e.options.type?function(){var e=this;document.getElementById(e.options.target).innerHTML="","onload"===e.options.inject&&(window.removeEventListener?window.removeEventListener("load",e.onloadInject,!1):window.attachEvent?window.detachEvent("onload",e.onloadInject):E.call(e,"ERROR: the  browser does not support an onload event-handler"))}.call(e):"lightbox"===e.options.type?t.call(e):E.call(e,"WARN: injected content not cleaned up"),b.call(e)},resize:w,redirect:k,scroll:S,populateForm:function(e){var t=this;if(null==e)E.call(t,"unable to populate fields on payment pages, null or empty object provided");else if(e.constructor&&e.constructor===Object){var a=!0;for(var n in e){var i=e[n];null==i||i.constructor&&(i.constructor===String||i.constructor===Number)||(E.call(t,"unable to populate fields on payment pages, property '"+n+"' must be a string"),a=!1)}if(a){E.call(t,"populating fields on payment pages...");var l={source:"hpp",action:"populate-form",data:e};D.call(t,l)}}else E.call(t,"unable to populate fields on payment pages, argument must be a JSON object")},submitForm:function(){E.call(this,"submitting form on payment pages...");D.call(this,{source:"hpp",action:"submit-form"})}}}();
//# sourceMappingURL=hpp-embedded-integration-library.js.map
